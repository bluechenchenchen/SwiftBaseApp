# iPhoneBaseApp çƒ­æ›´æ–°é…ç½®æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®ä½¿ç”¨ [Inject](https://github.com/krzysztofzablocki/Inject) æ–¹æ¡ˆå®ç° SwiftUI åº”ç”¨çš„çƒ­æ›´æ–°åŠŸèƒ½ã€‚çƒ­æ›´æ–°å¯ä»¥æ˜¾è‘—æé«˜å¼€å‘æ•ˆç‡ï¼Œé¿å…é¢‘ç¹çš„ç¼–è¯‘å’Œé‡å¯åº”ç”¨ï¼Œè®©ä»£ç ä¿®æ”¹èƒ½å¤Ÿå®æ—¶åæ˜ åœ¨è¿è¡Œä¸­çš„åº”ç”¨ä¸­ã€‚

## æŠ€æœ¯æ–¹æ¡ˆ

- **æ ¸å¿ƒåº“**: [Inject](https://github.com/krzysztofzablocki/Inject) - åŸºäº InjectionIII çš„ SwiftUI çƒ­æ›´æ–°è§£å†³æ–¹æ¡ˆ
- **åº•å±‚æ”¯æŒ**: [InjectionIII](https://github.com/johnno1962/InjectionIII) - æä¾›ä»£ç æ³¨å…¥èƒ½åŠ›
- **é€‚ç”¨æ¡†æ¶**: SwiftUIã€UIKitã€AppKit

## é¡¹ç›®é…ç½®

### 1. ä¾èµ–ç®¡ç†

é¡¹ç›®ä½¿ç”¨ Swift Package Manager ç®¡ç†ä¾èµ–ï¼ŒInject åº“é€šè¿‡ä»¥ä¸‹æ–¹å¼é›†æˆï¼š

```swift
// Package.swift
dependencies: [
    .package(url: "https://github.com/krzysztofzablocki/Inject.git", from: "1.2.4")
]
```

### 2. åº”ç”¨åˆå§‹åŒ–é…ç½®

åœ¨ `iPhoneBaseAppApp.swift` ä¸­é…ç½®çƒ­æ›´æ–°åˆå§‹åŒ–ï¼š

```swift
import SwiftUI
import Inject

#if DEBUG
import UIKit
private var loadInjection: Void = {
    #if os(macOS)
    Bundle(path: "/Applications/InjectionIII.app/Contents/Resources/macOSInjection.bundle")?.load()
    #elseif os(iOS)
    Bundle(path: "/Applications/InjectionIII.app/Contents/Resources/iOSInjection.bundle")?.load()
    #endif
}()
#endif

@main
struct iPhoneBaseAppApp: App {
    @State private var modelData = ModelData()
    @ObserveInjection var forceUpdate // å¼ºåˆ¶åˆ·æ–°è§†å›¾çŠ¶æ€

    init() {
        #if DEBUG
        print("---> InjectionIII åˆå§‹åŒ–")

        // çœŸæœºè®¾å¤‡è®¾ç½®å¼€å‘æœºIP
        #if !targetEnvironment(simulator)
        if let localIP = getLocalIPAddress() {
            UserDefaults.standard.set(localIP, forKey: "INJECTION_ADDRESS")
        }
        #endif

        _ = loadInjection
        #endif
    }

    var body: some Scene {
        WindowGroup {
            LandmarksContentView()
                .environment(modelData)
                .enableInjection() // Appæ ¹è§†å›¾æ ‡è®°
        }
    }
}
```

### 3. è§†å›¾çº§é…ç½®

åœ¨éœ€è¦çƒ­æ›´æ–°çš„ SwiftUI è§†å›¾ä¸­æ·»åŠ é…ç½®ï¼š

```swift
import SwiftUI
import Inject

struct YourView: View {
    @ObserveInjection var inject // æ³¨å…¥è§‚å¯Ÿå™¨

    var body: some View {
        // ä½ çš„è§†å›¾å†…å®¹
        VStack {
            Text("Hello World")
        }
        .enableInjection() // å¯ç”¨çƒ­æ›´æ–°
    }
}
```

### 4. å¤æ‚è§†å›¾æ›´æ–°å¤„ç†

å¯¹äºéœ€è¦å¼ºåˆ¶åˆ·æ–°çš„å¤æ‚è§†å›¾ï¼Œä½¿ç”¨ UUID ç»‘å®šï¼š

```swift
struct LandmarksContentView: View {
    @State private var selection: Tab = .featured
    @State private var refreshID = UUID() // æ·»åŠ æ³¨å…¥å“åº”çŠ¶æ€

    var body: some View {
        TabView(selection: $selection) {
            // è§†å›¾å†…å®¹
        }
        .enableInjection()
        .onReceive(NotificationCenter.default.publisher(for: Notification.Name("INJECTION_BUNDLE_NOTIFICATION"))) { _ in
            print("ğŸ”¥ æ¥æ”¶åˆ°æ³¨å…¥é€šçŸ¥")
            refreshID = UUID() // å¼ºåˆ¶æ›´æ–°è§†å›¾
        }
        .id(refreshID) // ç»‘å®šåˆ·æ–°ID
    }
}
```

## å¼€å‘ç¯å¢ƒé…ç½®

### 1. Xcode é¡¹ç›®é…ç½®

åœ¨ Xcode é¡¹ç›®ä¸­éœ€è¦æ·»åŠ é“¾æ¥å™¨æ ‡å¿—ï¼š

1. é€‰æ‹©é¡¹ç›® target
2. è¿›å…¥ Build Settings
3. æœç´¢"Other Linker Flags"
4. åœ¨ Debug é…ç½®ä¸­æ·»åŠ ï¼š`-Xlinker -interposable`

### 2. InjectionIII åº”ç”¨å®‰è£…

1. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ [InjectionIII](https://github.com/johnno1962/InjectionIII/releases)
2. è§£å‹å¹¶æ”¾ç½®åˆ° `/Applications` ç›®å½•
3. ç¡®ä¿ Xcode ä½äºé»˜è®¤ä½ç½®ï¼š`/Applications/Xcode.app`
4. è¿è¡Œ InjectionIII åº”ç”¨
5. é€‰æ‹©å½“å‰é¡¹ç›®çš„å·¥ä½œç©ºé—´æ–‡ä»¶

### 3. çœŸæœºå¼€å‘é…ç½®

å¯¹äºçœŸæœºå¼€å‘ï¼Œéœ€è¦é…ç½®ç½‘ç»œè¿æ¥ï¼š

```swift
// è·å–æœ¬æœºIPåœ°å€
func getLocalIPAddress() -> String? {
    var address: String?
    var ifaddr: UnsafeMutablePointer<ifaddrs>?

    guard getifaddrs(&ifaddr) == 0 else { return nil }
    guard let firstAddr = ifaddr else { return nil }

    for ifptr in sequence(first: firstAddr, next: { $0.pointee.ifa_next }) {
        let interface = ifptr.pointee
        let addrFamily = interface.ifa_addr.pointee.sa_family
        if addrFamily == UInt8(AF_INET) {
            let name = String(cString: interface.ifa_name)
            if name == "en0" {
                var hostname = [CChar](repeating: 0, count: Int(NI_MAXHOST))
                getnameinfo(interface.ifa_addr, socklen_t(interface.ifa_addr.pointee.sa_len),
                            &hostname, socklen_t(hostname.count),
                            nil, socklen_t(0), NI_NUMERICHOST)
                address = String(cString: hostname)
            }
        }
    }
    freeifaddrs(ifaddr)
    return address
}
```

## ä½¿ç”¨æŒ‡å—

### 1. å¯åŠ¨çƒ­æ›´æ–°

1. ç¡®ä¿ InjectionIII åº”ç”¨æ­£åœ¨è¿è¡Œ
2. åœ¨ Xcode ä¸­è¿è¡Œåº”ç”¨ï¼ˆDebug æ¨¡å¼ï¼‰
3. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œç¡®è®¤è¿æ¥æˆåŠŸï¼š
   ```
   ğŸ’‰ InjectionIII connected /path/to/your/project.xcworkspace
   ğŸ’‰ Watching files under /path/to/your/project
   ```

### 2. ä¿®æ”¹ä»£ç 

1. åœ¨ SwiftUI è§†å›¾ä¸­ä¿®æ”¹ä»£ç 
2. ä¿å­˜æ–‡ä»¶ï¼ˆCmd+Sï¼‰
3. è§‚å¯Ÿåº”ç”¨ä¸­çš„å®æ—¶æ›´æ–°

### 3. æ”¯æŒçš„ä¿®æ”¹ç±»å‹

- âœ… SwiftUI è§†å›¾ç»“æ„ä¿®æ”¹
- âœ… è§†å›¾å±æ€§ä¿®æ”¹
- âœ… æ ·å¼å’Œå¸ƒå±€ä¿®æ”¹
- âœ… çŠ¶æ€å˜é‡ä¿®æ”¹
- âœ… è®¡ç®—å±æ€§ä¿®æ”¹

### 4. ä¸æ”¯æŒçš„ä¿®æ”¹ç±»å‹

- âŒ ç»“æ„ä½“/ç±»çš„åˆå§‹åŒ–å™¨ä¿®æ”¹
- âŒ åè®®å®šä¹‰ä¿®æ”¹
- âŒ æšä¸¾å®šä¹‰ä¿®æ”¹
- âŒ å…¨å±€å‡½æ•°ä¿®æ”¹

## æœ€ä½³å®è·µ

### 1. è§†å›¾ç»„ç»‡

```swift
// æ¨èï¼šå°†å¤æ‚é€»è¾‘æ‹†åˆ†ä¸ºå­è§†å›¾
struct ParentView: View {
    @ObserveInjection var inject

    var body: some View {
        VStack {
            ChildView1()
            ChildView2()
        }
        .enableInjection()
    }
}

struct ChildView1: View {
    var body: some View {
        Text("Child 1")
    }
}
```

### 2. çŠ¶æ€ç®¡ç†

```swift
// æ¨èï¼šä½¿ç”¨@Stateè¿›è¡Œæœ¬åœ°çŠ¶æ€ç®¡ç†
struct MyView: View {
    @ObserveInjection var inject
    @State private var isExpanded = false

    var body: some View {
        VStack {
            Text(isExpanded ? "Expanded" : "Collapsed")
            Button("Toggle") {
                isExpanded.toggle()
            }
        }
        .enableInjection()
    }
}
```

### 3. åŠ¨ç”»é…ç½®

å¯ä»¥é…ç½®æ³¨å…¥æ—¶çš„åŠ¨ç”»æ•ˆæœï¼š

```swift
// åœ¨åº”ç”¨å¯åŠ¨æ—¶é…ç½®
InjectConfiguration.animation = .interactiveSpring()
```

## æ•…éšœæ’é™¤

### 1. å¸¸è§é—®é¢˜

**é—®é¢˜**: çƒ­æ›´æ–°ä¸å·¥ä½œ

- æ£€æŸ¥ InjectionIII æ˜¯å¦æ­£åœ¨è¿è¡Œ
- ç¡®è®¤é¡¹ç›®é…ç½®äº†æ­£ç¡®çš„é“¾æ¥å™¨æ ‡å¿—
- éªŒè¯ Xcode ç‰ˆæœ¬å’Œ InjectionIII ç‰ˆæœ¬å…¼å®¹æ€§

**é—®é¢˜**: çœŸæœºçƒ­æ›´æ–°å¤±è´¥

- ç¡®è®¤å¼€å‘æœºå’Œè®¾å¤‡åœ¨åŒä¸€ç½‘ç»œ
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- éªŒè¯ IP åœ°å€é…ç½®æ­£ç¡®

**é—®é¢˜**: è§†å›¾æ›´æ–°å¼‚å¸¸

- æ£€æŸ¥æ˜¯å¦æ­£ç¡®æ·»åŠ äº†`.enableInjection()`
- ç¡®è®¤ä½¿ç”¨äº†`@ObserveInjection var inject`
- å¯¹äºå¤æ‚è§†å›¾ï¼Œè€ƒè™‘ä½¿ç”¨ UUID å¼ºåˆ¶åˆ·æ–°

### 2. è°ƒè¯•æŠ€å·§

1. æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼Œç¡®è®¤ InjectionIII è¿æ¥çŠ¶æ€
2. ä½¿ç”¨`print`è¯­å¥éªŒè¯ä»£ç æ˜¯å¦è¢«é‡æ–°æ‰§è¡Œ
3. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼ˆçœŸæœºå¼€å‘æ—¶ï¼‰

### 3. æ€§èƒ½ä¼˜åŒ–

- é¿å…åœ¨çƒ­æ›´æ–°è§†å›¾ä¸­è¿›è¡Œå¤§é‡è®¡ç®—
- åˆç†ä½¿ç”¨`@State`å’Œ`@ObservedObject`
- åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„è§‚å¯Ÿå™¨

## ç”Ÿäº§ç¯å¢ƒ

çƒ­æ›´æ–°ä»£ç åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¼šè‡ªåŠ¨è¢«ä¼˜åŒ–æ‰ï¼Œä¸ä¼šå½±å“åº”ç”¨æ€§èƒ½ã€‚æ‰€æœ‰çƒ­æ›´æ–°ç›¸å…³çš„ä»£ç éƒ½åŒ…å«åœ¨`#if DEBUG`æ¡ä»¶ç¼–è¯‘ä¸­ï¼Œç¡®ä¿ç”Ÿäº§æ„å»ºçš„çº¯å‡€æ€§ã€‚

## å‚è€ƒèµ„æ–™

- [Inject GitHub ä»“åº“](https://github.com/krzysztofzablocki/Inject)
- [InjectionIII GitHub ä»“åº“](https://github.com/johnno1962/InjectionIII)
- [SwiftUI çƒ­æ›´æ–°æœ€ä½³å®è·µ](https://www.merowing.info/2021/01/hot-reloading-in-swiftui/)

---

_æœ€åæ›´æ–°: 2025 å¹´ 1 æœˆ_
